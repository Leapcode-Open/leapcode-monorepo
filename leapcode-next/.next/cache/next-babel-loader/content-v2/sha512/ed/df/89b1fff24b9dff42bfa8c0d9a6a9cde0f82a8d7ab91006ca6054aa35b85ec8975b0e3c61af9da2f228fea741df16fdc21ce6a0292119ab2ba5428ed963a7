{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/stanly/Documents/projects/leapcode-next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/stanly/Documents/projects/leapcode-next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/stanly/Documents/projects/leapcode-next/providers/AuthProvider.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { auth, provider } from '../config/firebase'; //import SkeletonLoading from \"../Components/SkeletonLoading\";\n\nimport cookie from 'js-cookie';\nimport { API_HEADERS, API_URL, COOKIE_TOKEN, getToken } from \"../config/constants\";\nexport var AuthContext = /*#__PURE__*/React.createContext();\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      currentUser = _useState[0],\n      setCurrentUser = _useState[1];\n\n  var _useState2 = useState(true),\n      pending = _useState2[0],\n      setPending = _useState2[1];\n\n  var _useState3 = useState(null),\n      token = _useState3[0],\n      setToken = _useState3[1];\n\n  var _useState4 = useState(null),\n      userDetails = _useState4[0],\n      setUserDetails = _useState4[1];\n\n  var _useState5 = useState(null),\n      claims = _useState5[0],\n      setClaims = _useState5[1];\n\n  var _useState6 = useState(false),\n      lpLoggedIn = _useState6[0],\n      setLpLoggedIn = _useState6[1];\n\n  var signOut = function signOut() {\n    auth().signOut().then(function (res) {\n      setToken(null);\n      setUserDetails(null);\n      cookie.remove(COOKIE_TOKEN);\n      window.location.href = \"/\";\n    });\n  };\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var authUser, userToken, loginInfo;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return auth().signInWithPopup(provider);\n\n            case 2:\n              authUser = _context.sent;\n              _context.next = 5;\n              return auth().currentUser.getIdToken();\n\n            case 5:\n              userToken = _context.sent;\n              _context.next = 8;\n              return fetch(API_URL + \"/auth/login\", {\n                method: 'POST',\n                headers: API_HEADERS,\n                body: JSON.stringify({\n                  token: userToken,\n                  username: authUser.additionalUserInfo ? authUser.additionalUserInfo.username : '',\n                  githubInfo: authUser.additionalUserInfo ? authUser.additionalUserInfo.profile : {}\n                })\n              });\n\n            case 8:\n              loginInfo = _context.sent;\n\n              if (loginInfo) {\n                _context.next = 11;\n                break;\n              }\n\n              return _context.abrupt(\"return\", signOut());\n\n            case 11:\n              window.location.reload();\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function login() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    auth().onAuthStateChanged( /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(user) {\n        var idClains, idToken, userD;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                setCurrentUser(user);\n\n                if (!user) {\n                  _context2.next = 15;\n                  break;\n                }\n\n                _context2.next = 4;\n                return user.getIdTokenResult();\n\n              case 4:\n                idClains = _context2.sent;\n                setClaims(idClains);\n                _context2.next = 8;\n                return user.getIdToken();\n\n              case 8:\n                idToken = _context2.sent;\n                cookie.set(COOKIE_TOKEN, idToken);\n                setToken(idToken);\n                userD = {\n                  displayName: user.displayName,\n                  email: user.email,\n                  emailVerified: user.emailVerified,\n                  photoURL: user.photoURL,\n                  uid: user.uid,\n                  metadata: user.metadata\n                };\n                setUserDetails(userD);\n                _context2.next = 18;\n                break;\n\n              case 15:\n                setCurrentUser(null);\n                setPending(false); //setToken(null)\n\n                cookie.remove(COOKIE_TOKEN);\n\n              case 18:\n                setPending(false);\n\n              case 19:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n  }, []); // if( pending ){\n  //   return (<div className=\"w-screen h-screen flex items-center justify-center\">\n  //     <div className=\"w-1/4 bg-white rounded-lg px-6 py-10 flex items-center flex-col\">\n  //       loading\n  //     </div>\n  //   </div>)\n  // }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      currentUser: currentUser,\n      authLoading: false,\n      setToken: setToken,\n      token: token,\n      userDetails: userDetails,\n      signOut: signOut,\n      claims: claims,\n      login: login\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(AuthProvider, \"3hmE0G4CCuONOGKdgxOBOlvDKqg=\");\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/stanly/Documents/projects/leapcode-next/providers/AuthProvider.js"],"names":["React","useEffect","useState","auth","provider","cookie","API_HEADERS","API_URL","COOKIE_TOKEN","getToken","AuthContext","createContext","AuthProvider","children","currentUser","setCurrentUser","pending","setPending","token","setToken","userDetails","setUserDetails","claims","setClaims","lpLoggedIn","setLpLoggedIn","signOut","then","res","remove","window","location","href","login","signInWithPopup","authUser","getIdToken","userToken","fetch","method","headers","body","JSON","stringify","username","additionalUserInfo","githubInfo","profile","loginInfo","reload","onAuthStateChanged","user","getIdTokenResult","idClains","idToken","set","userD","displayName","email","emailVerified","photoURL","uid","metadata","authLoading"],"mappings":"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","sourcesContent":["\nimport React, { useEffect, useState } from \"react\";\nimport { auth, provider } from '../config/firebase';\n//import SkeletonLoading from \"../Components/SkeletonLoading\";\nimport cookie from 'js-cookie';\nimport { API_HEADERS, API_URL, COOKIE_TOKEN, getToken } from \"../config/constants\";\n\nexport const AuthContext = React.createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [pending, setPending] = useState(true);\n  const [token, setToken] = useState(null);\n  const [userDetails, setUserDetails] = useState(null);\n  const [claims, setClaims] = useState(null);\n  const [lpLoggedIn, setLpLoggedIn] = useState(false);\n\n  const signOut = () => {\n    auth().signOut().then(res => {\n      setToken(null);\n      setUserDetails(null);\n      cookie.remove(COOKIE_TOKEN);\n      window.location.href=\"/\"\n    })\n  }\n\n\n  const login = async () => {\n    const authUser = await auth().signInWithPopup(provider);\n    const userToken = await auth().currentUser.getIdToken();\n    const loginInfo = await fetch(API_URL+`/auth/login`, {\n        method: 'POST',\n        headers: API_HEADERS,\n        body: JSON.stringify({\n            token: userToken,\n            username: authUser.additionalUserInfo ? authUser.additionalUserInfo.username : '',\n            githubInfo: authUser.additionalUserInfo ? authUser.additionalUserInfo.profile : {}\n        })\n    });\n\n    if(!loginInfo) {\n      return signOut();\n    }\n\n    window.location.reload()\n  }\n\n  useEffect(() => {\n    auth().onAuthStateChanged( async (user) => {\n      setCurrentUser(user)\n      if(user) {\n\n        const idClains = await user.getIdTokenResult();\n        setClaims(idClains);\n        const idToken = await user.getIdToken();\n        cookie.set(COOKIE_TOKEN, idToken);\n        setToken(idToken);\n        const userD = {\n          displayName: user.displayName,\n          email: user.email,\n          emailVerified: user.emailVerified,\n          photoURL: user.photoURL,\n          uid: user.uid,\n          metadata: user.metadata\n        }\n        setUserDetails(userD)\n      }\n      \n      else {\n        setCurrentUser(null)\n        setPending(false);\n        //setToken(null)\n        cookie.remove(COOKIE_TOKEN);\n      }\n\n      setPending(false);\n      \n    });\n  }, []);\n\n\n\n\n  // if( pending ){\n  //   return (<div className=\"w-screen h-screen flex items-center justify-center\">\n  //     <div className=\"w-1/4 bg-white rounded-lg px-6 py-10 flex items-center flex-col\">\n  //       loading\n  //     </div>\n  //   </div>)\n  // }\n\n\n  return (\n    <AuthContext.Provider\n      value={{\n        currentUser,\n        authLoading: false,\n        setToken,\n        token,\n        userDetails,\n        signOut,\n        claims,\n        login\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};"]},"metadata":{},"sourceType":"module"}